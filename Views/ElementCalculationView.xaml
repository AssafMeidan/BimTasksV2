<UserControl x:Class="BimTasksV2.Views.ElementCalculationView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:prism="http://prismlibrary.com/"
             prism:ViewModelLocator.AutoWireViewModel="True"
             FlowDirection="RightToLeft"
             Background="#F5F5F5">

    <UserControl.Resources>
        <SolidColorBrush x:Key="PrimaryBrush" Color="#1976D2"/>
        <SolidColorBrush x:Key="PrimaryDarkBrush" Color="#1565C0"/>
        <SolidColorBrush x:Key="CardBackgroundBrush" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="BorderBrush" Color="#E0E0E0"/>
        <SolidColorBrush x:Key="TextPrimaryBrush" Color="#212121"/>
        <SolidColorBrush x:Key="TextSecondaryBrush" Color="#757575"/>

        <Style x:Key="CardStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource CardBackgroundBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="Margin" Value="8"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="8" ShadowDepth="2" Opacity="0.15" Direction="270"/>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="CategoryHeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="{StaticResource PrimaryBrush}"/>
            <Setter Property="Margin" Value="0,0,0,12"/>
        </Style>

        <Style x:Key="LabelStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
            <Setter Property="Margin" Value="0,4,0,2"/>
        </Style>

        <Style x:Key="ValueStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
        </Style>

        <Style x:Key="CountBadgeStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource PrimaryBrush}"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="HorizontalAlignment" Value="Left"/>
            <Setter Property="Margin" Value="0,0,0,8"/>
        </Style>

        <Style x:Key="ActionButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource PrimaryBrush}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                CornerRadius="4"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{StaticResource PrimaryDarkBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#0D47A1"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="TotalCardStyle" TargetType="Border" BasedOn="{StaticResource CardStyle}">
            <Setter Property="Background" Value="{StaticResource PrimaryBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>

        <BooleanToVisibilityConverter x:Key="BoolToVisConverter"/>
    </UserControl.Resources>

    <Grid>
        <!-- Loading Overlay -->
        <Border Background="#80FFFFFF"
                Visibility="{Binding IsCalculating, Converter={StaticResource BoolToVisConverter}}"
                Panel.ZIndex="100">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <TextBlock Text="Calculating..." FontSize="18" Foreground="{StaticResource PrimaryBrush}"
                           HorizontalAlignment="Center" Margin="0,0,0,8"/>
                <ProgressBar IsIndeterminate="True" Width="200" Height="4"/>
            </StackPanel>
        </Border>

        <!-- Main Content -->
        <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="8">
            <StackPanel>

                <!-- Header -->
                <Border Style="{StaticResource CardStyle}" Margin="8,8,8,4">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Area and Volume Calculations"
                                       FontSize="20" FontWeight="Bold"
                                       Foreground="{StaticResource TextPrimaryBrush}"/>
                            <TextBlock Text="{Binding StatusMessage}"
                                       FontSize="12"
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       Margin="0,4,0,0"/>
                        </StackPanel>

                        <Button Grid.Column="1"
                                Content="Copy"
                                Style="{StaticResource ActionButtonStyle}"
                                Command="{Binding CopyToClipboardCommand}"
                                Margin="8,0"/>

                        <Button Grid.Column="2"
                                Content="Recalculate"
                                Style="{StaticResource ActionButtonStyle}"
                                Command="{Binding RecalculateCommand}"/>
                    </Grid>
                </Border>

                <!-- Total Concrete Volume -->
                <Border Style="{StaticResource TotalCardStyle}" Margin="8,4">
                    <StackPanel>
                        <TextBlock Text="Total Concrete Volume"
                                   FontSize="14"
                                   Foreground="#B3FFFFFF"/>
                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                            <TextBlock Text="{Binding TotalConcreteVolume, StringFormat={}{0:F2}}"
                                       FontSize="36" FontWeight="Bold"
                                       Foreground="White"/>
                            <TextBlock Text=" m3"
                                       FontSize="18"
                                       Foreground="#B3FFFFFF"
                                       VerticalAlignment="Bottom"
                                       Margin="4,0,0,8"/>
                        </StackPanel>
                        <TextBlock Foreground="#B3FFFFFF" FontSize="12" Margin="0,8,0,0">
                            <Run Text="Selected: "/>
                            <Run Text="{Binding SelectedElementCount, Mode=OneWay}"/>
                            <Run Text=" | Calculated: "/>
                            <Run Text="{Binding TotalElementCount, Mode=OneWay}"/>
                        </TextBlock>
                    </StackPanel>
                </Border>

                <!-- Cards Grid -->
                <UniformGrid Columns="3" Margin="0,4">

                    <!-- Walls -->
                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <TextBlock Text="Walls" Style="{StaticResource CategoryHeaderStyle}"/>
                            <Border Style="{StaticResource CountBadgeStyle}">
                                <TextBlock Foreground="White" FontSize="12">
                                    <Run Text="{Binding WallCount, Mode=OneWay}"/> <Run Text=" walls"/>
                                </TextBlock>
                            </Border>
                            <TextBlock Text="Area" Style="{StaticResource LabelStyle}"/>
                            <TextBlock Style="{StaticResource ValueStyle}">
                                <Run Text="{Binding WallArea, StringFormat={}{0:F2}, Mode=OneWay}"/>
                                <Run Text=" m2" Foreground="{StaticResource TextSecondaryBrush}"/>
                            </TextBlock>
                            <TextBlock Text="Volume" Style="{StaticResource LabelStyle}"/>
                            <TextBlock Style="{StaticResource ValueStyle}">
                                <Run Text="{Binding WallVolume, StringFormat={}{0:F2}, Mode=OneWay}"/>
                                <Run Text=" m3" Foreground="{StaticResource TextSecondaryBrush}"/>
                            </TextBlock>
                        </StackPanel>
                    </Border>

                    <!-- Floors -->
                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <TextBlock Text="Floors" Style="{StaticResource CategoryHeaderStyle}"/>
                            <Border Style="{StaticResource CountBadgeStyle}">
                                <TextBlock Foreground="White" FontSize="12">
                                    <Run Text="{Binding FloorCount, Mode=OneWay}"/> <Run Text=" floors"/>
                                </TextBlock>
                            </Border>
                            <TextBlock Text="Area" Style="{StaticResource LabelStyle}"/>
                            <TextBlock Style="{StaticResource ValueStyle}">
                                <Run Text="{Binding FloorArea, StringFormat={}{0:F2}, Mode=OneWay}"/>
                                <Run Text=" m2" Foreground="{StaticResource TextSecondaryBrush}"/>
                            </TextBlock>
                            <TextBlock Text="Volume" Style="{StaticResource LabelStyle}"/>
                            <TextBlock Style="{StaticResource ValueStyle}">
                                <Run Text="{Binding FloorVolume, StringFormat={}{0:F2}, Mode=OneWay}"/>
                                <Run Text=" m3" Foreground="{StaticResource TextSecondaryBrush}"/>
                            </TextBlock>
                        </StackPanel>
                    </Border>

                    <!-- Beams -->
                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <TextBlock Text="Beams" Style="{StaticResource CategoryHeaderStyle}"/>
                            <Border Style="{StaticResource CountBadgeStyle}">
                                <TextBlock Foreground="White" FontSize="12">
                                    <Run Text="{Binding BeamCount, Mode=OneWay}"/> <Run Text=" beams"/>
                                </TextBlock>
                            </Border>
                            <TextBlock Text="Volume" Style="{StaticResource LabelStyle}"/>
                            <TextBlock Style="{StaticResource ValueStyle}">
                                <Run Text="{Binding BeamVolume, StringFormat={}{0:F2}, Mode=OneWay}"/>
                                <Run Text=" m3" Foreground="{StaticResource TextSecondaryBrush}"/>
                            </TextBlock>
                            <TextBlock Text="Length" Style="{StaticResource LabelStyle}"/>
                            <TextBlock Style="{StaticResource ValueStyle}">
                                <Run Text="{Binding BeamLength, StringFormat={}{0:F2}, Mode=OneWay}"/>
                                <Run Text=" m" Foreground="{StaticResource TextSecondaryBrush}"/>
                            </TextBlock>
                        </StackPanel>
                    </Border>

                    <!-- Columns -->
                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <TextBlock Text="Columns" Style="{StaticResource CategoryHeaderStyle}"/>
                            <Border Style="{StaticResource CountBadgeStyle}">
                                <TextBlock Foreground="White" FontSize="12">
                                    <Run Text="{Binding ColumnCount, Mode=OneWay}"/> <Run Text=" columns"/>
                                </TextBlock>
                            </Border>
                            <TextBlock Text="Volume" Style="{StaticResource LabelStyle}"/>
                            <TextBlock Style="{StaticResource ValueStyle}">
                                <Run Text="{Binding ColumnVolume, StringFormat={}{0:F2}, Mode=OneWay}"/>
                                <Run Text=" m3" Foreground="{StaticResource TextSecondaryBrush}"/>
                            </TextBlock>
                            <TextBlock Text="Height" Style="{StaticResource LabelStyle}"/>
                            <TextBlock Style="{StaticResource ValueStyle}">
                                <Run Text="{Binding ColumnHeight, StringFormat={}{0:F2}, Mode=OneWay}"/>
                                <Run Text=" m" Foreground="{StaticResource TextSecondaryBrush}"/>
                            </TextBlock>
                        </StackPanel>
                    </Border>

                    <!-- Stairs -->
                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <TextBlock Text="Stairs - Concrete" Style="{StaticResource CategoryHeaderStyle}"/>
                            <Border Style="{StaticResource CountBadgeStyle}">
                                <TextBlock Foreground="White" FontSize="12">
                                    <Run Text="{Binding StairCount, Mode=OneWay}"/>
                                    <Run Text=" stairs ("/>
                                    <Run Text="{Binding StairRiserCount, Mode=OneWay}"/>
                                    <Run Text=" risers)"/>
                                </TextBlock>
                            </Border>
                            <TextBlock Text="Concrete Volume" Style="{StaticResource LabelStyle}"/>
                            <TextBlock Style="{StaticResource ValueStyle}">
                                <Run Text="{Binding StairVolume, StringFormat={}{0:F2}, Mode=OneWay}"/>
                                <Run Text=" m3" Foreground="{StaticResource TextSecondaryBrush}"/>
                            </TextBlock>
                            <TextBlock Text="Tread Length" Style="{StaticResource LabelStyle}"/>
                            <TextBlock Style="{StaticResource ValueStyle}">
                                <Run Text="{Binding StairTreadLength, StringFormat={}{0:F2}, Mode=OneWay}"/>
                                <Run Text=" m" Foreground="{StaticResource TextSecondaryBrush}"/>
                            </TextBlock>
                        </StackPanel>
                    </Border>

                    <!-- Stair Runs -->
                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <TextBlock Text="Stair Runs - Flooring" Style="{StaticResource CategoryHeaderStyle}"/>
                            <Border Style="{StaticResource CountBadgeStyle}">
                                <TextBlock Foreground="White" FontSize="12">
                                    <Run Text="{Binding StairRunCount, Mode=OneWay}"/> <Run Text=" runs"/>
                                </TextBlock>
                            </Border>
                            <TextBlock Text="Tread Length" Style="{StaticResource LabelStyle}"/>
                            <TextBlock Style="{StaticResource ValueStyle}">
                                <Run Text="{Binding StairRunTreadLength, StringFormat={}{0:F2}, Mode=OneWay}"/>
                                <Run Text=" m" Foreground="{StaticResource TextSecondaryBrush}"/>
                            </TextBlock>
                        </StackPanel>
                    </Border>

                    <!-- Landings -->
                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <TextBlock Text="Landings - Flooring" Style="{StaticResource CategoryHeaderStyle}"/>
                            <Border Style="{StaticResource CountBadgeStyle}">
                                <TextBlock Foreground="White" FontSize="12">
                                    <Run Text="{Binding LandingCount, Mode=OneWay}"/> <Run Text=" landings"/>
                                </TextBlock>
                            </Border>
                            <TextBlock Text="Flooring Area" Style="{StaticResource LabelStyle}"/>
                            <TextBlock Style="{StaticResource ValueStyle}">
                                <Run Text="{Binding LandingArea, StringFormat={}{0:F2}, Mode=OneWay}"/>
                                <Run Text=" m2" Foreground="{StaticResource TextSecondaryBrush}"/>
                            </TextBlock>
                            <TextBlock Text="Volume" Style="{StaticResource LabelStyle}"/>
                            <TextBlock Style="{StaticResource ValueStyle}">
                                <Run Text="{Binding LandingVolume, StringFormat={}{0:F2}, Mode=OneWay}"/>
                                <Run Text=" m3" Foreground="{StaticResource TextSecondaryBrush}"/>
                            </TextBlock>
                        </StackPanel>
                    </Border>

                    <!-- Foundations -->
                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <TextBlock Text="Foundations" Style="{StaticResource CategoryHeaderStyle}"/>
                            <Border Style="{StaticResource CountBadgeStyle}">
                                <TextBlock Foreground="White" FontSize="12">
                                    <Run Text="{Binding FoundationCount, Mode=OneWay}"/> <Run Text=" foundations"/>
                                </TextBlock>
                            </Border>
                            <TextBlock Text="Area" Style="{StaticResource LabelStyle}"/>
                            <TextBlock Style="{StaticResource ValueStyle}">
                                <Run Text="{Binding FoundationArea, StringFormat={}{0:F2}, Mode=OneWay}"/>
                                <Run Text=" m2" Foreground="{StaticResource TextSecondaryBrush}"/>
                            </TextBlock>
                            <TextBlock Text="Volume" Style="{StaticResource LabelStyle}"/>
                            <TextBlock Style="{StaticResource ValueStyle}">
                                <Run Text="{Binding FoundationVolume, StringFormat={}{0:F2}, Mode=OneWay}"/>
                                <Run Text=" m3" Foreground="{StaticResource TextSecondaryBrush}"/>
                            </TextBlock>
                        </StackPanel>
                    </Border>

                    <!-- Railings -->
                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <TextBlock Text="Railings" Style="{StaticResource CategoryHeaderStyle}"/>
                            <Border Style="{StaticResource CountBadgeStyle}">
                                <TextBlock Foreground="White" FontSize="12">
                                    <Run Text="{Binding RailingCount, Mode=OneWay}"/> <Run Text=" railings"/>
                                </TextBlock>
                            </Border>
                            <TextBlock Text="Length" Style="{StaticResource LabelStyle}"/>
                            <TextBlock Style="{StaticResource ValueStyle}">
                                <Run Text="{Binding RailingLength, StringFormat={}{0:F2}, Mode=OneWay}"/>
                                <Run Text=" m" Foreground="{StaticResource TextSecondaryBrush}"/>
                            </TextBlock>
                        </StackPanel>
                    </Border>

                    <!-- Doors -->
                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <TextBlock Text="Doors" Style="{StaticResource CategoryHeaderStyle}"/>
                            <Border Style="{StaticResource CountBadgeStyle}">
                                <TextBlock Foreground="White" FontSize="12">
                                    <Run Text="{Binding DoorCount, Mode=OneWay}"/> <Run Text=" doors"/>
                                </TextBlock>
                            </Border>
                        </StackPanel>
                    </Border>

                    <!-- Windows -->
                    <Border Style="{StaticResource CardStyle}">
                        <StackPanel>
                            <TextBlock Text="Windows" Style="{StaticResource CategoryHeaderStyle}"/>
                            <Border Style="{StaticResource CountBadgeStyle}">
                                <TextBlock Foreground="White" FontSize="12">
                                    <Run Text="{Binding WindowCount, Mode=OneWay}"/> <Run Text=" windows"/>
                                </TextBlock>
                            </Border>
                        </StackPanel>
                    </Border>
                </UniformGrid>

                <!-- Footer -->
                <Border Style="{StaticResource CardStyle}" Margin="8,4,8,8" Padding="12">
                    <TextBlock FontSize="11" Foreground="{StaticResource TextSecondaryBrush}" TextAlignment="Center">
                        <Run Text="Calculation time: "/>
                        <Run Text="{Binding CalculationTimeMs, Mode=OneWay}"/>
                        <Run Text="ms | BimTasks Element Calculator"/>
                    </TextBlock>
                </Border>

            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>
